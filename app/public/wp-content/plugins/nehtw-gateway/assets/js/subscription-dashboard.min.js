/*! For license information please see subscription-dashboard.min.js.LICENSE.txt */
(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:()=>d});const n=window.React;var r=e.n(n);function a(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",c=n.toStringTag||"@@toStringTag";function o(n,r,a,c){var o=r&&r.prototype instanceof i?r:i,u=Object.create(o.prototype);return l(u,"_invoke",function(n,r,a){var l,c,o,i=0,u=a||[],m=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return l=t,c=0,o=e,d.n=n,s}};function p(n,r){for(c=n,o=r,t=0;!m&&i&&!a&&t<u.length;t++){var a,l=u[t],p=d.p,f=l[2];n>3?(a=f===r)&&(o=l[(c=l[4])?5:(c=3,3)],l[4]=l[5]=e):l[0]<=p&&((a=n<2&&p<l[1])?(c=0,d.v=r,d.n=l[1]):p<f&&(a=n<3||l[0]>r||r>f)&&(l[4]=n,l[5]=r,d.n=f,c=0))}if(a||n>1)return s;throw m=!0,r}return function(a,u,f){if(i>1)throw TypeError("Generator is already running");for(m&&1===u&&p(u,f),c=u,o=f;(t=c<2?e:o)||!m;){l||(c?c<3?(c>1&&(d.n=-1),p(c,o)):d.n=o:d.v=o);try{if(i=2,l){if(c||(a="next"),t=l[a]){if(!(t=t.call(l,o)))throw TypeError("iterator result is not an object");if(!t.done)return t;o=t.value,c<2&&(c=0)}else 1===c&&(t=l.return)&&t.call(l),c<2&&(o=TypeError("The iterator does not provide a '"+a+"' method"),c=1);l=e}else if((t=(m=d.n<0)?o:n.call(r,d))!==s)break}catch(t){l=e,c=1,o=t}finally{i=1}}return{value:t,done:m}}}(n,a,c),!0),u}var s={};function i(){}function u(){}function m(){}t=Object.getPrototypeOf;var d=[][r]?t(t([][r]())):(l(t={},r,function(){return this}),t),p=m.prototype=i.prototype=Object.create(d);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,c,"GeneratorFunction")),e.prototype=Object.create(p),e}return u.prototype=m,l(p,"constructor",m),l(m,"constructor",u),u.displayName="GeneratorFunction",l(m,c,"GeneratorFunction"),l(p),l(p,c,"Generator"),l(p,r,function(){return this}),l(p,"toString",function(){return"[object Generator]"}),(a=function(){return{w:o,m:f}})()}function l(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}l=function(e,t,n,r){function c(t,n){l(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(c("next",0),c("throw",1),c("return",2))},l(e,t,n,r)}function c(e,t,n,r,a,l,c){try{var o=e[l](c),s=o.value}catch(e){return void n(e)}o.done?t(s):Promise.resolve(s).then(r,a)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var l=e.apply(t,n);function o(e){c(l,r,a,o,s,"next",e)}function s(e){c(l,r,a,o,s,"throw",e)}o(void 0)})}}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,l,c,o=[],s=!0,i=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=l.call(n)).done)&&(o.push(r.value),o.length!==t);s=!0);}catch(e){i=!0,a=e}finally{try{if(!s&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(i)throw a}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var u=function(){var e,t,l=s((0,n.useState)(null),2),c=l[0],i=l[1],u=s((0,n.useState)(null),2),d=u[0],p=u[1],f=s((0,n.useState)([]),2),v=f[0],h=f[1],b=s((0,n.useState)([]),2),y=b[0],w=b[1],E=s((0,n.useState)(!0),2),g=E[0],N=E[1],S=s((0,n.useState)(!1),2),j=S[0],_=S[1];(0,n.useEffect)(function(){k()},[]);var k=function(){var e=o(a().m(function e(){var t,n,r,l,c,o,u,m,d;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Promise.all([fetch("/wp-json/nehtw/v1/subscription",{credentials:"same-origin"}),fetch("/wp-json/nehtw/v1/invoices",{credentials:"same-origin"}),fetch("/wp-json/nehtw/v1/plans",{credentials:"same-origin"})]);case 1:return t=e.v,n=s(t,3),r=n[0],l=n[1],c=n[2],e.n=2,r.json();case 2:return o=e.v,e.n=3,l.json();case 3:return u=e.v,e.n=4,c.json();case 4:m=e.v,i(o.subscription),p(o.usage),h(u),w(m),N(!1),e.n=6;break;case 5:e.p=5,d=e.v,console.error("Error loading data:",d),N(!1);case 6:return e.a(2)}},e,null,[[0,5]])}));return function(){return e.apply(this,arguments)}}(),P=function(){var e=o(a().m(function e(t){var n,r,l;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/wp-json/nehtw/v1/subscription/change-plan",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({new_plan_key:t,apply_immediately:!0})});case 1:return n=e.v,e.n=2,n.json();case 2:(r=e.v).success?(alert("Plan changed successfully!"),k(),_(!1)):alert("Failed to change plan: "+(r.message||"Unknown error")),e.n=4;break;case 3:e.p=3,l=e.v,alert("Error changing plan: "+l.message);case 4:return e.a(2)}},e,null,[[0,3]])}));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=o(a().m(function e(){var t,n;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(confirm("Are you sure you want to pause your subscription?")){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,fetch("/wp-json/nehtw/v1/subscription/pause",{method:"POST",credentials:"same-origin"});case 2:return t=e.v,e.n=3,t.json();case 3:e.v.success&&(alert("Subscription paused successfully!"),k()),e.n=5;break;case 4:e.p=4,n=e.v,alert("Error pausing subscription: "+n.message);case 5:return e.a(2)}},e,null,[[1,4]])}));return function(){return e.apply(this,arguments)}}(),C=function(){var e=o(a().m(function e(){var t,n,r;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(null!==(t=prompt("Please tell us why you're cancelling (optional):"))){e.n=1;break}return e.a(2);case 1:if(confirm("Are you sure you want to cancel your subscription?")){e.n=2;break}return e.a(2);case 2:return e.p=2,e.n=3,fetch("/wp-json/nehtw/v1/subscription/cancel",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:t,cancel_immediately:!1})});case 3:return n=e.v,e.n=4,n.json();case 4:e.v.success&&(alert("Subscription cancelled. You will retain access until the end of your billing period."),k()),e.n=6;break;case 5:e.p=5,r=e.v,alert("Error cancelling subscription: "+r.message);case 6:return e.a(2)}},e,null,[[2,5]])}));return function(){return e.apply(this,arguments)}}();if(g)return r().createElement("div",{className:"nehtw-subscription-dashboard loading"},r().createElement("div",{className:"loading-spinner"}),r().createElement("p",null,"Loading your subscription details..."));if(!c)return r().createElement("div",{className:"nehtw-subscription-dashboard no-subscription"},r().createElement("h2",null,"No Active Subscription"),r().createElement("p",null,"You don't have an active subscription. Choose a plan to get started!"),r().createElement("button",{className:"nehtw-btn-primary",onClick:function(){return _(!0)}},"View Plans"));var T=d?d.total_usage/c.points_per_interval*100:0;return r().createElement("div",{className:"nehtw-subscription-dashboard"},r().createElement("div",{className:"nehtw-glass-card current-plan-card"},r().createElement("div",{className:"card-header"},r().createElement("h2",null,"Current Plan"),r().createElement("span",{className:"nehtw-badge plan-badge"},(null===(e=y[c.plan_key])||void 0===e?void 0:e.name)||c.plan_key)),r().createElement("div",{className:"plan-details"},r().createElement("div",{className:"points-balance"},r().createElement("div",{className:"balance-amount"},c.points_per_interval),r().createElement("div",{className:"balance-label"},"Points per ",c.interval)),r().createElement("div",{className:"renewal-info"},r().createElement("div",{className:"renewal-label"},"Next Billing"),r().createElement("div",{className:"renewal-date"},new Date(c.next_renewal_at).toLocaleDateString()),r().createElement("div",{className:"renewal-amount"},"$",(null===(t=y[c.plan_key])||void 0===t?void 0:t.price)||0,"/",c.interval))),r().createElement("div",{className:"plan-actions"},r().createElement("button",{className:"nehtw-btn-primary",onClick:function(){return _(!0)}},"Change Plan"),r().createElement("button",{className:"nehtw-btn-secondary",onClick:O},"Pause Subscription"))),d&&r().createElement("div",{className:"nehtw-glass-card usage-card"},r().createElement("h3",null,"Usage This Month"),r().createElement("div",{className:"usage-bar-container"},r().createElement("div",{className:"usage-bar"},r().createElement("div",{className:"usage-fill",style:{width:"".concat(Math.min(T,100),"%")}})),r().createElement("div",{className:"usage-label"},d.total_usage," of ",c.points_per_interval," points used (",T.toFixed(0),"%)"))),r().createElement("div",{className:"nehtw-glass-card billing-history-card"},r().createElement("div",{className:"card-header"},r().createElement("h3",null,"Billing History")),r().createElement("table",{className:"nehtw-billing-table"},r().createElement("thead",null,r().createElement("tr",null,r().createElement("th",null,"Date"),r().createElement("th",null,"Invoice"),r().createElement("th",null,"Amount"),r().createElement("th",null,"Status"),r().createElement("th",null,"Actions"))),r().createElement("tbody",null,v.map(function(e){return r().createElement("tr",{key:e.id},r().createElement("td",null,new Date(e.created_at).toLocaleDateString()),r().createElement("td",null,e.invoice_number),r().createElement("td",null,"$",parseFloat(e.total_amount).toFixed(2)),r().createElement("td",null,r().createElement("span",{className:"nehtw-status-badge nehtw-status-".concat(e.status)},e.status)),r().createElement("td",null,r().createElement("a",{href:"/wp-json/nehtw/v1/invoices/".concat(e.id,"/download"),className:"nehtw-btn-link",target:"_blank",rel:"noopener noreferrer"},"Download PDF")))})))),r().createElement("div",{className:"nehtw-glass-card actions-card"},r().createElement("h3",null,"Subscription Actions"),r().createElement("div",{className:"action-buttons"},r().createElement("button",{className:"nehtw-btn-secondary",onClick:C},"Cancel Subscription"))),j&&r().createElement(m,{plans:y,currentPlan:c.plan_key,onClose:function(){return _(!1)},onSelect:P}))},m=function(e){var t=e.plans,n=e.currentPlan,a=e.onClose,l=e.onSelect;return r().createElement("div",{className:"nehtw-modal-overlay",onClick:a},r().createElement("div",{className:"nehtw-modal nehtw-glass-card",onClick:function(e){return e.stopPropagation()}},r().createElement("div",{className:"modal-header"},r().createElement("h2",null,"Choose Your Plan"),r().createElement("button",{className:"modal-close",onClick:a},"Ã—")),r().createElement("div",{className:"modal-body"},r().createElement("div",{className:"plans-grid"},Object.entries(t).map(function(e){var t=s(e,2),a=t[0],c=t[1];return r().createElement("div",{key:a,className:"plan-card ".concat(a===n?"current":"")},r().createElement("h3",null,c.name),r().createElement("div",{className:"plan-price"},"$",c.price,"/month"),r().createElement("div",{className:"plan-points"},c.points," points"),r().createElement("ul",{className:"plan-features"},c.features&&c.features.map(function(e,t){return r().createElement("li",{key:t},e)})),a===n?r().createElement("button",{className:"nehtw-btn-secondary",disabled:!0},"Current Plan"):r().createElement("button",{className:"nehtw-btn-primary",onClick:function(){return l(a)}},"Select Plan"))})))))};"undefined"!=typeof window&&(window.SubscriptionDashboard=u);const d=u;window.SubscriptionDashboard=t})();